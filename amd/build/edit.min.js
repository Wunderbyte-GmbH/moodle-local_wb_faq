define("local_wb_faq/edit",["exports","core_form/modalform","core/modal_factory","core/modal_events","core/str","local_wb_faq/notifications","local_wb_faq/admin","local_wb_faq/faq"],(function(_exports,_modalform,_modal_factory,_modal_events,_str,_notifications,_admin,_faq){function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}
/*
   * @package    local_wunderbyte_table
   * @copyright  Wunderbyte GmbH <info@wunderbyte.at>
   * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later
   */Object.defineProperty(_exports,"__esModule",{value:!0}),_exports.confirmDeleteEntry=confirmDeleteEntry,_exports.confirmToggleVisibility=confirmToggleVisibility,_exports.init=void 0,_modalform=_interopRequireDefault(_modalform),_modal_factory=_interopRequireDefault(_modal_factory),_modal_events=_interopRequireDefault(_modal_events);const SELECTORS_GROUPSUBMIT='[data-action="groupSubmit"]';_exports.init=()=>{document.querySelectorAll(".local_wb_faq_container").forEach((element=>{element.dataset.initialized||(element.addEventListener("click",editModalListener),element.dataset.initialized=!0)}))};const editModalListener=event=>{let button=event.target;"i"===button.tagName.toLowerCase()&&(button=button.parentElement),button.classList.contains("local_wb_faq_edit_question")?function(event){let button=event.target,entryid=0,parentid=0,uid=0;"a"!==button.tagName.toLowerCase()&&(button=button.parentElement);button.dataset.id&&(entryid=button.dataset.id);button.dataset.faqroot&&(parentid=button.dataset.faqroot);button.dataset.uid&&(uid=button.dataset.uid);const modalForm=new _modalform.default({formClass:"local_wb_faq\\form\\editQuestionForm",args:{id:entryid,type:1,nobuttons:!0,parentid:parentid},modalConfig:{title:(0,_str.get_string)("addquestion","local_wb_faq")},returnFocus:button});modalForm.addEventListener(modalForm.events.FORM_SUBMITTED,(()=>{(0,_notifications.showSuccessNotification)(),uid?(0,_faq.reloadData)(uid,parentid):window.location.reload()})),modalForm.show().then((()=>{})).catch((e=>{console.log(e),(0,_notifications.showErrorNotification)()}))}(event):button.classList.contains("local_wb_faq_delete_question")?confirmDeleteEntry(event):button.classList.contains("local_wb_faq_toggle_entry_visibility")||button.classList.contains("local_wb_faq_toggle_category_visibility")?confirmToggleVisibility(event):button.classList.contains("local_wb_faq_edit_category")?function(event){let button=event.target,entryid=0,parentid=0,uid=0;"a"!==button.tagName.toLowerCase()&&(button=button.parentElement);button.dataset.id&&(entryid=button.dataset.id);button.dataset.faqroot&&(parentid=button.dataset.faqroot);button.dataset.uid&&(uid=button.dataset.uid);const modalForm=new _modalform.default({formClass:"local_wb_faq\\form\\editCategoriesForm",args:{id:entryid,type:0,nobuttons:!0,parentid:parentid},modalConfig:{title:(0,_str.get_string)("addcategory","local_wb_faq")},returnFocus:button});modalForm.addEventListener("change",(e=>{if("reloadForm"==e.target.dataset.onChangeAction){const button=document.querySelector(SELECTORS_GROUPSUBMIT);modalForm.processNoSubmitButton(button)}})),modalForm.addEventListener(modalForm.events.FORM_SUBMITTED,(()=>{(0,_notifications.showSuccessNotification)(),uid?(0,_faq.reloadData)(uid,parentid):window.location.reload()})),modalForm.show().then((()=>{})).catch((e=>{console.log(e),(0,_notifications.showErrorNotification)()}))}(event):button.classList.contains("local_wb_faq_delete_category")&&confirmDeleteEntry(event)};function confirmDeleteEntry(event){let button=event.target,entryid=0;if("a"!=button.tagName.toLowerCase()&&"button"!=button.tagName.toLowerCase()&&(button=button.parentElement),button.classList.contains("local_wb_faq_delete_question"))button.dataset.id&&(entryid=button.dataset.id);else if(button.classList.contains("local_wb_faq_delete_category"))button.dataset.id&&(entryid=button.dataset.id);else{if(!button.dataset||!button.dataset.action||"delete"!=button.dataset.action)return;entryid=button.dataset.targetid}(0,_str.get_strings)([{key:"confirmdeleteentrytitle",component:"local_wb_faq"},{key:"confirmdeleteentrybody",component:"local_wb_faq"},{key:"confirmdeleteentry",component:"local_wb_faq"}]).then((strings=>(_modal_factory.default.create({type:_modal_factory.default.types.SAVE_CANCEL}).then((modal=>(modal.setTitle(strings[0]),modal.setBody(strings[1]),modal.setSaveButtonText(strings[2]),modal.getRoot().on(_modal_events.default.save,(function(){let entry=button.closest("li.accordion-item"),elementid=0;entry?elementid=entry.dataset.id:(entry=button.closest('[data-action="goto"]'),entry?elementid=entry.dataset.targetid:(entry=event.target.closest("tr"),elementid=button.dataset.targetid)),elementid==entryid&&(entry.remove(),(0,_admin.deleteEntry)(entryid),(0,_notifications.showSuccessNotification)())})),modal.show(),modal))).catch((e=>{console.log(e),(0,_notifications.showErrorNotification)()})),!0))).catch((e=>{console.log(e),(0,_notifications.showErrorNotification)()}))}function confirmToggleVisibility(event){let button=event.target,entryid=0;if("a"!==button.tagName.toLowerCase()&&(button=button.parentElement),button.classList.contains("local_wb_faq_toggle_entry_visibility"))button.dataset.id&&(entryid=button.dataset.id);else{if(!button.classList.contains("local_wb_faq_toggle_category_visibility"))return;button.dataset.id&&(entryid=button.dataset.id)}(0,_str.get_strings)([{key:"confirmtogglevisibilitytitle",component:"local_wb_faq"},{key:"confirmtogglevisibilitybody",component:"local_wb_faq"},{key:"confirmtogglevisibility",component:"local_wb_faq"}]).then((strings=>(_modal_factory.default.create({type:_modal_factory.default.types.SAVE_CANCEL}).then((modal=>(modal.setTitle(strings[0]),modal.setBody(strings[1]),modal.setSaveButtonText(strings[2]),modal.getRoot().on(_modal_events.default.save,(function(){let entry=button.closest("li.accordion-item"),elementid=0;if(entry?elementid=entry.dataset.id:(entry=button.closest('[data-action="goto"]'),elementid=entry.dataset.targetid),elementid==entryid){(0,_admin.toggleVisibility)(entryid);let ielement=button.querySelector("i.toggle-visibility");ielement?(ielement.classList.contains("fa-eye-slash")?ielement.classList.replace("fa-eye-slash","fa-eye"):ielement.classList.replace("fa-eye","fa-eye-slash"),(0,_notifications.showSuccessNotification)(),window.location.reload()):window.location.reload()}})),modal.show(),modal))).catch((e=>{console.log(e),(0,_notifications.showErrorNotification)()})),!0))).catch((e=>{console.log(e),(0,_notifications.showErrorNotification)()}))}}));

//# sourceMappingURL=edit.min.js.map