{"version":3,"file":"searchinput.min.js","sources":["../src/searchinput.js"],"sourcesContent":["\n// This file is part of Moodle - http://moodle.org/\n//\n// Moodle is free software: you can redistribute it and/or modify\n// it under the terms of the GNU General Public License as published by\n// the Free Software Foundation, either version 3 of the License, or\n// (at your option) any later version.\n//\n// Moodle is distributed in the hope that it will be useful,\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n// GNU General Public License for more details.\n//\n// You should have received a copy of the GNU General Public License\n// along with Moodle.  If not, see <http://www.gnu.org/licenses/>.\n\n/*\n * @package    local_wunderbyte_table\n * @copyright  Wunderbyte GmbH <info@wunderbyte.at>\n * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later\n */\nimport Templates from 'core/templates';\nimport {get_string as getString} from 'core/str';\nimport {increaseCounter} from \"local_wb_faq/faqnavbar\";\n\nvar searcharray = [];\n\nexport const searchInput = (inputClass, elementToHide, elementToSearch) => {\n\n    let input, filter, li, a, i, txtValue;\n    input = document.querySelector(inputClass);\n    filter = normalizeString(input.value.toUpperCase());\n    li = document.querySelectorAll(elementToHide);\n    for (i = 0; i < li.length; i++) {\n        a = li[i].querySelector(elementToSearch);\n        txtValue = normalizeString(a.textContent || a.innerText);\n        if (txtValue.toUpperCase().indexOf(filter) > -1) {\n            li[i].style.display = \"\";\n        } else {\n            li[i].style.display = \"none\";\n        }\n    }\n};\n\nconst normalizeString = str => str\n    .normalize(\"NFD\")\n    .replace(/ä/g, 'ae').replace(/Ä/g, 'Ae')\n    .replace(/ö/g, 'oe').replace(/Ö/g, 'Oe')\n    .replace(/ü/g, 'ue').replace(/Ü/g, 'Ue')\n    .replace(/ß/g, 'ss')\n    .toUpperCase();\n\n\nexport const searchJSON = (listContainer, inputClass, json) => {\n    let arr = [];\n    let container = document.querySelector(listContainer);\n    let searchVal = normalizeString(document.querySelector(inputClass).value);\n\n    if (typeof json === 'string') {\n        json = JSON.parse(json);\n    }\n\n    if (searchVal.length > 3) {\n        let i = 0;\n        Object.values(json).forEach(e => {\n            if ((e.content && normalizeString(e.content).indexOf(searchVal) > -1)\n                || (e.title && normalizeString(e.title).indexOf(searchVal) > -1)) {\n                arr[i] = e;\n                if (e.type == 0) {\n                    arr[i].iscategory = true;\n                }\n                i++;\n            }\n        });\n\n        const shouldRender = (\n            arr.length !== searcharray.length ||\n            arr.some((item, idx) => item.id !== searcharray[idx]?.id)\n        );\n\n        if (shouldRender) {\n            render(arr, container);\n        }\n\n        searcharray = arr;\n\n        if (searcharray.length < 1) {\n            getString('noresult', 'local_wb_faq').then(value => {\n                container.innerHTML = value;\n                return;\n            }).catch(e => {\n                // eslint-disable-next-line no-console\n                console.log(e);\n            });\n            increaseCounter();\n        } else {\n            increaseCounter(true);\n        }\n\n    } else if (searchVal.length == 0) {\n        container.innerHTML = '';\n        searcharray = [];\n\n    } else {\n        getString('stringtooshort', 'local_wb_faq').then(value => {\n            container.innerHTML = value;\n            return;\n        }).catch(e => {\n            // eslint-disable-next-line no-console\n            console.log(e);\n        });\n\n        searcharray = [];\n    }\n};\n\nexport const init = (searchInputID, listContainer, elementToHide, elementToSearch, json = null) => {\n\n    const searchInputElement = document.querySelector(searchInputID);\n\n    if (searchInputElement) {\n        searchInputElement.addEventListener('keyup', function() {\n            searchJSON(listContainer, searchInputID, json);\n        });\n    }\n};\n\n\nexport const render = (data, container) => {\n    Templates.renderForPromise('local_wb_faq/searchbox', {items: data}).then(({html}) => {\n        container.innerHTML = \"\";\n        container.insertAdjacentHTML('afterbegin', html);\n        return;\n    }).catch(e => {\n        // eslint-disable-next-line no-console\n        console.log(e);\n    });\n};"],"names":["searcharray","inputClass","elementToHide","elementToSearch","input","filter","li","a","i","txtValue","document","querySelector","normalizeString","value","toUpperCase","querySelectorAll","length","textContent","innerText","indexOf","style","display","str","normalize","replace","searchJSON","listContainer","json","arr","container","searchVal","JSON","parse","Object","values","forEach","e","content","title","type","iscategory","some","item","idx","id","_searcharray$idx","render","then","innerHTML","catch","console","log","searchInputID","searchInputElement","addEventListener","data","renderForPromise","items","_ref","html","insertAdjacentHTML"],"mappings":";;;;;6MAyBIA,YAAc,wBAES,CAACC,WAAYC,cAAeC,uBAE/CC,MAAOC,OAAQC,GAAIC,EAAGC,EAAGC,aAC7BL,MAAQM,SAASC,cAAcV,YAC/BI,OAASO,gBAAgBR,MAAMS,MAAMC,eACrCR,GAAKI,SAASK,iBAAiBb,eAC1BM,EAAI,EAAGA,EAAIF,GAAGU,OAAQR,IACvBD,EAAID,GAAGE,GAAGG,cAAcR,iBACxBM,SAAWG,gBAAgBL,EAAEU,aAAeV,EAAEW,WAC1CT,SAASK,cAAcK,QAAQd,SAAW,EAC1CC,GAAGE,GAAGY,MAAMC,QAAU,GAEtBf,GAAGE,GAAGY,MAAMC,QAAU,cAK5BT,gBAAkBU,KAAOA,IAC1BC,UAAU,OACVC,QAAQ,KAAM,MAAMA,QAAQ,KAAM,MAClCA,QAAQ,KAAM,MAAMA,QAAQ,KAAM,MAClCA,QAAQ,KAAM,MAAMA,QAAQ,KAAM,MAClCA,QAAQ,KAAM,MACdV,cAGQW,WAAa,CAACC,cAAezB,WAAY0B,YAC9CC,IAAM,GACNC,UAAYnB,SAASC,cAAce,eACnCI,UAAYlB,gBAAgBF,SAASC,cAAcV,YAAYY,UAE/C,iBAATc,OACPA,KAAOI,KAAKC,MAAML,OAGlBG,UAAUd,OAAS,EAAG,KAClBR,EAAI,EACRyB,OAAOC,OAAOP,MAAMQ,SAAQC,KACnBA,EAAEC,SAAWzB,gBAAgBwB,EAAEC,SAASlB,QAAQW,YAAc,GAC3DM,EAAEE,OAAS1B,gBAAgBwB,EAAEE,OAAOnB,QAAQW,YAAc,KAC9DF,IAAIpB,GAAK4B,EACK,GAAVA,EAAEG,OACFX,IAAIpB,GAAGgC,YAAa,GAExBhC,SAKJoB,IAAIZ,SAAWhB,YAAYgB,QAC3BY,IAAIa,MAAK,CAACC,KAAMC,mCAAQD,KAAKE,+BAAO5C,YAAY2C,wCAAZE,iBAAkBD,SAItDE,OAAOlB,IAAKC,YAGhB7B,YAAc4B,KAEEZ,OAAS,uBACX,WAAY,gBAAgB+B,MAAKlC,QACvCgB,UAAUmB,UAAYnC,SAEvBoC,OAAMb,IAELc,QAAQC,IAAIf,wEAIA,QAGO,GAApBN,UAAUd,QACjBa,UAAUmB,UAAY,GACtBhD,YAAc,yBAGJ,iBAAkB,gBAAgB+C,MAAKlC,QAC7CgB,UAAUmB,UAAYnC,SAEvBoC,OAAMb,IAELc,QAAQC,IAAIf,MAGhBpC,YAAc,kDAIF,SAACoD,cAAe1B,cAAexB,cAAeC,qBAAiBwB,4DAAO,WAEhF0B,mBAAqB3C,SAASC,cAAcyC,eAE9CC,oBACAA,mBAAmBC,iBAAiB,SAAS,WACzC7B,WAAWC,cAAe0B,cAAezB,gBAMxCmB,OAAS,CAACS,KAAM1B,gCACf2B,iBAAiB,yBAA0B,CAACC,MAAOF,OAAOR,MAAKW,WAACC,KAACA,WACvE9B,UAAUmB,UAAY,GACtBnB,UAAU+B,mBAAmB,aAAcD,SAE5CV,OAAMb,IAELc,QAAQC,IAAIf"}