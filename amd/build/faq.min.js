define("local_wb_faq/faq",["exports","core/templates","local_wb_faq/faqnavbar","core/ajax"],(function(_exports,_templates,_faqnavbar,_ajax){function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}
/*
   * @package    local_wunderbyte_table
   * @copyright  Wunderbyte GmbH <info@wunderbyte.at>
   * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later
   */Object.defineProperty(_exports,"__esModule",{value:!0}),_exports.reloadData=_exports.loadData=_exports.init=void 0,_templates=_interopRequireDefault(_templates),_ajax=_interopRequireDefault(_ajax);const faqs={};var initialroot=0;const SELECTORS_SUPPORTMESSAGE_MODULE='div[data-id="supportmessage-form"] input[name="module"][type="hidden"]',SELECTORS_SUPPORTMESSAGE_SUPPLEMENT='div[data-id="supportmessage-form"] input[name="group"][type="hidden"]';function addEvents(data,root,uid){let select=document.querySelector(".local_wb_faq_container-"+uid);if(!select)return;select.listener&&select.removeEventListener("click",select.listener),select&&select.addEventListener("click",select.listener=e=>{!function(e){(0,_faqnavbar.increaseCounter)();const moduleElement=document.querySelector(SELECTORS_SUPPORTMESSAGE_MODULE),supplementElement=document.querySelector(SELECTORS_SUPPORTMESSAGE_SUPPLEMENT);moduleElement&&(moduleElement.value=e.target.dataset.module);supplementElement&&(supplementElement.value=e.target.dataset.supplement)}(e);let button=e.target;"faqcollapse"==button.dataset.toggle&&(button.classList.contains("collapsed")?(button.classList.remove("collapsed"),document.querySelector(button.dataset.target).classList.add("show"),document.querySelector(button.dataset.target).classList.remove("hide"),button.setAttribute("aria-expanded","true")):(button.classList.add("collapsed"),document.querySelector(button.dataset.target).classList.add("hide"),document.querySelector(button.dataset.target).classList.remove("show"),button.setAttribute("aria-expanded","false"))),"goto"==e.target.dataset.action&&render(e.target.dataset.targetid,data,uid)});let searchbox=document.querySelector(".wb_faq_searchbox-"+uid);searchbox&&searchbox.addEventListener("click",(e=>{let button=e.target;"faqcollapse"==button.dataset.toggle&&(button.classList.contains("collapsed")?(button.classList.remove("collapsed"),document.querySelector(button.dataset.target).classList.add("show"),document.querySelector(button.dataset.target).classList.remove("hide"),button.setAttribute("aria-expanded","true")):(button.classList.add("collapsed"),document.querySelector(button.dataset.target).classList.add("hide"),document.querySelector(button.dataset.target).classList.remove("show"),button.setAttribute("aria-expanded","false"))),"goto"==e.target.dataset.action&&(render(e.target.dataset.targetid,data,uid),document.querySelector(".local_wb_faq-"+uid).scrollIntoView({block:"start",behavior:"smooth"}))}));let category=document.querySelector("#id_categorypicker");category&&category.addEventListener("change",(()=>{let faqid=category.value;""==category.value&&(faqid=root),render(faqid,data)}))}function render(id,data,uid){let json=data;"string"==typeof data&&(json=JSON.parse(data));let templatedata=json[id]??null;templatedata||(templatedata={root:id,uid:uid,canedit:!0,categories:[],entries:[]}),templatedata.root=id,templatedata.uid=uid;let container=document.querySelector(".local_wb_faq-"+uid);container&&(container.innerHTML="",_templates.default.renderForPromise("local_wb_faq/faq",templatedata).then((_ref=>{let{html:html,js:js}=_ref;_templates.default.replaceNodeContents(".local_wb_faq-"+uid,html,js);const breadcrumbs=container.querySelectorAll(".wb-breadcrumb div.btn");breadcrumbs.forEach((breadcrumb=>{try{if(0!=breadcrumb.dataset.targetid&&!json[breadcrumb.dataset.targetid])throw new Error}catch(e){breadcrumb.classList.add("hidefaq")}}));const last=breadcrumbs[breadcrumbs.length-1],first=breadcrumbs[0];0!=initialroot&&(first.classList.remove(["btn-primary"]),first.classList.add(["btn-nolabel"]),first.removeAttribute("data-action"),first.classList.add("hidefaq")),last.classList.remove(["btn-primary"]),last.classList.add(["btn-nolabel"]),last.removeAttribute("data-action"),last.classList.add("hidefaq")})).catch((e=>{console.log(e)})))}_exports.init=(data,root,uid)=>{faqs[uid]||(faqs[uid]=!0,initialroot=root,render(root,data,uid),addEvents(data,root,uid))};_exports.reloadData=(uid,parentid)=>{loadData(uid,parentid)};const loadData=(uid,parentid)=>{_ajax.default.call([{methodname:"local_wb_faq_get_faq_data",args:{},done:function(data){let newdata=JSON.parse(data.json);newdata&&0!==Object.keys(newdata).length||(newdata={0:{parentid:"",title:"Welcome to the FAQ",entries:[]}}),uid&&(addEvents(newdata,parentid,uid),render(parentid,newdata,uid))},fail:function(ex){console.log(ex)}}])};_exports.loadData=loadData}));

//# sourceMappingURL=faq.min.js.map